/*! ezcrop - v0.0.3 <https://github.com/nterms/ezcrop> */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):"object"==typeof exports?exports.ezcrop=t():e.ezcrop=t()}(this,function(){return function(e){function t(o){if(i[o])return i[o].exports;var n=i[o]={exports:{},id:o,loaded:!1};return e[o].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}([function(e,t,i){function o(e){return e&&e.__esModule?e:{"default":e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(){for(var e=1;e<arguments.length;e++)for(var t in arguments[e])arguments[e].hasOwnProperty(t)&&(arguments[0][t]=arguments[e][t]);return arguments[0]}function a(e,t){e.classList?e.classList.add(t):e.className+=" "+t}function r(e,t){e.classList?e.classList.remove(t):e.className=e.className.replace(new RegExp("(^|\\b)"+t.split(" ").join("|")+"(\\b|$)","gi")," ")}function h(e,t,i){t.forEach(function(t){e.addEventListener(t,i)})}function m(e,t,i){t.forEach(function(t){e.removeEventListener(t,i)})}Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}(),u=i(1),g=o(u),d=i(2),p=i(3),f=i(4),c=function(){function e(t,i){n(this,e),this.el=t;var o=p.loadDefaults(this.el);this.options=s({},o,i),this.init()}return l(e,[{key:"init",value:function(){var e=this;this.img=new Image,this.preImage=new Image,this.img.onload=this.onImageLoaded.bind(this),this.preImage.onload=this.onPreImageLoaded.bind(this),this.img.onerror=this.preImage.onerror=function(){e.onImageError.call(e,d.ERRORS.IMAGE_FAILED_TO_LOAD)},this.preview=this.options.preview,this.fileInput=this.options.fileInput,this.zoomSlider=this.options.zoomSlider,this.preview.style.position="relative",this.fileInput.setAttribute("accept","image/*"),this.zoomSlider.setAttribute("min",0),this.zoomSlider.setAttribute("max",1),this.zoomSlider.setAttribute("step",.01),this.previewSize={width:this.options.width||this.preview.clientWidth,height:this.options.height||this.preview.clientHeight},this.image=document.createElement("img"),a(this.image,d.CLASS_NAMES.PREVIEW_IMAGE),this.image.setAttribute("alt",""),this.image.style.transformOrigin="top left",this.image.style.webkitTransformOrigin="top left",this.imageContainer=document.createElement("div"),a(this.imageContainer,d.CLASS_NAMES.PREVIEW_IMAGE_CONTAINER),this.imageContainer.setAttribute("style","position: absolute; overflow: hidden; left: 0; top: 0; width: 100%; height: 100%;"),this.imageContainer.appendChild(this.image),this.preview.appendChild(this.imageContainer),this.options.imageBackground&&(Array.isArray(this.options.imageBackgroundBorderWidth)?this.bgBorderWidthArray=this.options.imageBackgroundBorderWidth:this.bgBorderWidthArray=[0,1,2,3].map(function(){return e.options.imageBackgroundBorderWidth}),this.bg=document.createElement("img"),a(this.bg,d.CLASS_NAMES.PREVIEW_BACKGROUND),this.bg.setAttribute("alt",""),this.bg.setAttribute("style","position: relative; left: "+this.bgBorderWidthArray[3]+"; top: "+this.bgBorderWidthArray[0]+"; transform-origin: top left; -webkit-transform-origin: top left;"),this.bgContainer=document.createElement("div"),a(this.bgContainer,d.CLASS_NAMES.PREVIEW_BACKGROUND_CONTAINER),this.bgContainer.setAttribute("style","position: absolute; z-index: 0; top: -"+this.bgBorderWidthArray[0]+"; right: -"+this.bgBorderWidthArray[1]+"; bottom: -"+this.bgBorderWidthArray[2]+"; left: -"+this.bgBorderWidthArray[3]+";"),this.bgContainer.appendChild(this.bg),this.bgBorderWidthArray[0]>0&&(this.bgContainer.style.overflow="hidden"),this.preview.insertBefore(this.bgContainer,this.preview.firstChild)),this.initialZoom=this.options.initialZoom,this.imageLoaded=!1,this.moveContinue=!1,this.zoomer=new g["default"],this.options.allowDragNDrop,this.bindListeners(),this.options.imageState&&this.options.imageState.src&&this.loadImage(this.options.imageState.src),this.el.setAttribute("data-ezcrop",this)}},{key:"bindListeners",value:function(){h(this.fileInput,["change"],this.onFileChange.bind(this)),h(this.imageContainer,d.EVENTS.PREVIEW,this.onPreviewEvent.bind(this)),h(this.zoomSlider,d.EVENTS.ZOOM_INPUT,this.onZoomSliderChange.bind(this)),this.options.allowDragNDrop&&(h(this.imageContainer,["dragover","dragleave"],this.onDragOver.bind(this)),h(this.imageContainer,["drop"],this.onDrop.bind(this)))}},{key:"unbindListeners",value:function(){m(this.fileInput,["change"],this.onFileChange),m(this.imageContainer,d.EVENTS.PREVIEW,this.onPreviewEvent),m(this.imageContainer,["dragover","dragleave","drop"],this.onDragOver),m(this.zoomSlider,d.EVENTS.ZOOM_INPUT,this.onZoomSliderChange)}},{key:"onFileChange",value:function(e){this.options.onFileChange(e),this.fileInput.files&&this.loadFile(this.fileInput.files[0])}},{key:"calculateExportZoom",value:function(){var e=this.options.exportZoom;return this.options.exportWidth&&this.options.exportWidth>=this.previewSize.width&&(e=this.options.exportWidth/this.previewSize.width),e}},{key:"loadFile",value:function(e){var t=new FileReader;e&&e.type.match("image")?(t.readAsDataURL(e),t.onload=this.onFileReaderLoaded.bind(this),t.onerror=this.onFileReaderError.bind(this)):e&&this.onFileReaderError()}},{key:"onFileReaderLoaded",value:function(e){this.loadImage(e.target.result)}},{key:"onFileReaderError",value:function(){this.options.onFileReaderError()}},{key:"onDragOver",value:function(e){e.preventDefault(),e.dataTransfer.dropEffect="copy","dragover"===e.type?a(this.preview,d.CLASS_NAMES.DRAG_HOVERED):r(this.preview,d.CLASS_NAMES.DRAG_HOVERED)}},{key:"onDrop",value:function(e){var t=this;e.preventDefault(),e.stopPropagation();var i=Array.prototype.slice.call(e.dataTransfer.files,0);i.some(function(e){return e.type.match("image")?(t.loadFile(e),!0):!1}),r(this.preview,d.CLASS_NAMES.DRAG_HOVERED)}},{key:"loadImage",value:function(e){var t=this;if(e)if(this.options.onImageLoading(),this.setImageLoadingClass(),0===e.indexOf("data"))this.preImage.src=e;else{var i=new XMLHttpRequest;i.onload=function(e){return e.target.status>=300?void t.onImageError.call(t,d.ERRORS.IMAGE_FAILED_TO_LOAD):void t.loadFile(e.target.response)},i.open("GET",e),i.responseType="blob",i.send()}}},{key:"onPreImageLoaded",value:function(){return this.shouldRejectImage({imageWidth:this.preImage.width,imageHeight:this.preImage.height,previewSize:this.previewSize,maxZoom:this.options.maxZoom,exportZoom:this.calculateExportZoom(),smallImage:this.options.smallImage})?(this.onImageError(d.ERRORS.SMALL_IMAGE),void(this.img.src&&this.setImageLoadedClass())):void(this.img.src=this.preImage.src)}},{key:"onImageLoaded",value:function(){this.rotation=0,this.setupZoomer(this.options.imageState&&this.options.imageState.zoom||this._initialZoom),this.options.imageState&&this.options.imageState.offset?this.offset=this.options.imageState.offset:this.centerImage(),this.options.imageState={},this.image.setAttribute("src",this.img.src),this.options.imageBackground&&this.bg.setAttribute("src",this.img.src),this.setImageLoadedClass(),this.imageLoaded=!0,this.options.onImageLoaded()}},{key:"onImageError",value:function(){this.options.onImageError.apply(this,arguments),this.removeImageLoadingClass()}},{key:"setImageLoadingClass",value:function(){r(this.preview,d.CLASS_NAMES.IMAGE_LOADED),a(this.preview,d.CLASS_NAMES.IMAGE_LOADING)}},{key:"setImageLoadedClass",value:function(){r(this.preview,d.CLASS_NAMES.IMAGE_LOADING),a(this.preview,d.CLASS_NAMES.IMAGE_LOADED)}},{key:"removeImageLoadingClass",value:function(){r(this.preview,d.CLASS_NAMES.IMAGE_LOADING)}},{key:"getEventPosition",value:function(e){return e.originalEvent&&e.originalEvent.touches&&e.originalEvent.touches[0]&&(e=e.originalEvent.touches[0]),e.clientX&&e.clientY?{x:e.clientX,y:e.clientY}:void 0}},{key:"onPreviewEvent",value:function(e){return this.imageLoaded?(this.moveContinue=!1,m(this.imageContainer,d.EVENTS.PREVIEW_MOVE,this.onMove),"mousedown"===e.type||"touchstart"===e.type?(e.preventDefault(),this.origin=this.getEventPosition(e),this.moveContinue=!0,h(this.imageContainer,d.EVENTS.PREVIEW_MOVE,this.onMove.bind(this))):document.body.focus(),e.stopPropagation(),!1):void 0}},{key:"onMove",value:function(e){var t=this.getEventPosition(e);return this.moveContinue&&t&&(this.offset={x:this.offset.x+t.x-this.origin.x,y:this.offset.y+t.y-this.origin.y}),this.origin=t,e.stopPropagation(),!1}},{key:"fixOffset",value:function(e){if(!this.imageLoaded)return e;var t={x:e.x,y:e.y};return this.options.freeMove||(this.imageWidth*this.zoom>=this.previewSize.width?t.x=Math.min(0,Math.max(t.x,this.previewSize.width-this.imageWidth*this.zoom)):t.x=Math.max(0,Math.min(t.x,this.previewSize.width-this.imageWidth*this.zoom)),this.imageHeight*this.zoom>=this.previewSize.height?t.y=Math.min(0,Math.max(t.y,this.previewSize.height-this.imageHeight*this.zoom)):t.y=Math.max(0,Math.min(t.y,this.previewSize.height-this.imageHeight*this.zoom))),t.x=f.round(t.x),t.y=f.round(t.y),t}},{key:"centerImage",value:function(){this.img.width&&this.img.height&&this.zoom&&(this.offset={x:(this.previewSize.width-this.imageWidth*this.zoom)/2,y:(this.previewSize.height-this.imageHeight*this.zoom)/2})}},{key:"onZoomSliderChange",value:function(){if(this.imageLoaded){this.zoomSliderPos=Number(this.zoomSlider.value);var e=this.zoomer.getZoom(this.zoomSliderPos);e!==this.zoom&&(this.zoom=e)}}},{key:"enableZoomSlider",value:function(){this.zoomSlider.removeAttribute("disabled"),this.options.onZoomEnabled()}},{key:"disableZoomSlider",value:function(){this.zoomSlider.setAttribute("disabled",!0),this.options.onZoomDisabled()}},{key:"setupZoomer",value:function(e){this.zoomer.setup({imageSize:this.imageSize,previewSize:this.previewSize,exportZoom:this.calculateExportZoom(),maxZoom:this.options.maxZoom,minZoom:this.options.minZoom,smallImage:this.options.smallImage}),this.zoom=f.exists(e)?e:this._zoom,this.isZoomable()?this.enableZoomSlider():this.disableZoomSlider()}},{key:"fixZoom",value:function(e){return this.zoomer.fixZoom(e)}},{key:"isZoomable",value:function(){return this.zoomer.isZoomable()}},{key:"renderImage",value:function(){var e="\n      translate("+this.rotatedOffset.x+"px, "+this.rotatedOffset.y+"px)\n      scale("+this.zoom+")\n      rotate("+this.rotation+"deg)";this.image.style.transform=e,this.image.style.webkitTransform=e,this.options.imageBackground&&(this.bg.style.transform=e,this.bg.style.webkitTransform=e)}},{key:"rotateCW",value:function(){this.shouldRejectImage({imageWidth:this.img.height,imageHeight:this.img.width,previewSize:this.previewSize,maxZoom:this.options.maxZoom,exportZoom:this.calculateExportZoom(),smallImage:this.options.smallImage})?this.rotation=(this.rotation+180)%360:this.rotation=(this.rotation+90)%360}},{key:"rotateCCW",value:function(){this.shouldRejectImage({imageWidth:this.img.height,imageHeight:this.img.width,previewSize:this.previewSize,maxZoom:this.options.maxZoom,exportZoom:this.calculateExportZoom(),smallImage:this.options.smallImage})?this.rotation=(this.rotation+180)%360:this.rotation=(this.rotation+270)%360}},{key:"shouldRejectImage",value:function(e){var t=e.imageWidth,i=e.imageHeight,o=e.previewSize,n=e.maxZoom,s=e.exportZoom,a=e.smallImage;return"reject"!==a?!1:t*n<o.width*s||i*n<o.height*s}},{key:"getCroppedImageData",value:function(e){if(this.img.src){var t={type:"image/png",quality:.75,originalSize:!1,fillBg:"#fff"};e=s({},t,e);var i=e.originalSize?1/this.zoom:this.calculateExportZoom(),o={width:this.zoom*i*this.img.width,height:this.zoom*i*this.img.height},n=document.createElement("canvas");n.setAttribute("width",this.previewSize.width*i),n.setAttribute("height",this.previewSize.height*i);var a=n.getContext("2d");return"image/jpeg"===e.type&&(a.fillStyle=e.fillBg,a.fillRect(0,0,n.width,n.height)),a.translate(this.rotatedOffset.x*i,this.rotatedOffset.y*i),a.rotate(this.rotation*Math.PI/180),a.drawImage(this.img,0,0,o.width,o.height),n.toDataURL(e.type,e.quality)}}},{key:"disable",value:function(){this.unbindListeners(),this.disableZoomSlider(),this.el.addClass(d.CLASS_NAMES.DISABLED)}},{key:"reenable",value:function(){this.bindListeners(),this.enableZoomSlider(),this.el.removeClass(d.CLASS_NAMES.DISABLED)}},{key:"$",value:function(e){return this.el?this.el.querySelectorAll(e):null}},{key:"offset",set:function(e){e&&f.exists(e.x)&&f.exists(e.y)&&(this._offset=this.fixOffset(e),this.renderImage(),this.options.onOffsetChange(e))},get:function(){return this._offset}},{key:"zoom",set:function(e){if(e=this.fixZoom(e),this.imageLoaded){var t=this.zoom,i=this.previewSize.width/2-(this.previewSize.width/2-this.offset.x)*e/t,o=this.previewSize.height/2-(this.previewSize.height/2-this.offset.y)*e/t;this._zoom=e,this.offset={x:i,y:o}}else this._zoom=e;this.zoomSliderPos=this.zoomer.getSliderPos(this.zoom),this.zoomSlider.value=this.zoomSliderPos,this.options.onZoomChange(e)},get:function(){return this._zoom}},{key:"rotatedOffset",get:function(){return{x:this.offset.x+(90===this.rotation?this.img.height*this.zoom:0)+(180===this.rotation?this.img.width*this.zoom:0),y:this.offset.y+(180===this.rotation?this.img.height*this.zoom:0)+(270===this.rotation?this.img.width*this.zoom:0)}}},{key:"rotation",set:function(e){this._rotation=e,this.imageLoaded&&this.setupZoomer()},get:function(){return this._rotation}},{key:"imageState",get:function(){return{src:this.img.src,offset:this.offset,zoom:this.zoom}}},{key:"imageSrc",get:function(){return this.img.src},set:function(e){this.loadImage(e)}},{key:"imageWidth",get:function(){return this.rotation%180===0?this.img.width:this.img.height}},{key:"imageHeight",get:function(){return this.rotation%180===0?this.img.height:this.img.width}},{key:"imageSize",get:function(){return{width:this.imageWidth,height:this.imageHeight}}},{key:"initialZoom",get:function(){return this.options.initialZoom},set:function(e){this.options.initialZoom=e,"min"===e?this._initialZoom=0:"image"===e?this._initialZoom=1:this._initialZoom=0}},{key:"exportZoom",get:function(){return this.options.exportZoom},set:function(e){this.options.exportZoom=e,this.setupZoomer()}},{key:"calculatedExportZoom",get:function(){return this.calculateExportZoom()}},{key:"minZoom",get:function(){return this.options.minZoom},set:function(e){this.options.minZoom=e,this.setupZoomer()}},{key:"maxZoom",get:function(){return this.options.maxZoom},set:function(e){this.options.maxZoom=e,this.setupZoomer()}},{key:"previewSize",get:function(){return this._previewSize},set:function(e){!e||e.width<=0||e.height<=0||(this._previewSize={width:e.width,height:e.height},this.preview.style.width=this.previewSize.width+"px",this.preview.style.height=this.previewSize.height+"px",this.imageLoaded&&this.setupZoomer())}}]),e}();t["default"]=c,e.exports=t["default"]},function(e,t){function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}(),n=function(){function e(){i(this,e),this.minZoom=this.maxZoom=1}return o(e,[{key:"setup",value:function(e){var t=e.imageSize,i=e.previewSize,o=e.exportZoom,n=e.maxZoom,s=e.minZoom,a=e.smallImage,r=i.width/t.width,h=i.height/t.height;"fit"===s?this.minZoom=Math.min(r,h):this.minZoom=Math.max(r,h),"allow"===a&&(this.minZoom=Math.min(this.minZoom,1)),this.maxZoom=Math.max(this.minZoom,n/o)}},{key:"getZoom",value:function(e){return this.minZoom&&this.maxZoom?e*(this.maxZoom-this.minZoom)+this.minZoom:null}},{key:"getSliderPos",value:function(e){return this.minZoom&&this.maxZoom?this.minZoom===this.maxZoom?0:(e-this.minZoom)/(this.maxZoom-this.minZoom):null}},{key:"isZoomable",value:function(){return this.minZoom&&this.maxZoom?this.minZoom!==this.maxZoom:null}},{key:"fixZoom",value:function(e){return Math.max(this.minZoom,Math.min(this.maxZoom,e))}}]),e}();t["default"]=n,e.exports=t["default"]},function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i="ezcrop";t.PLUGIN_KEY=i;var o={PREVIEW:"ezcrop-preview",PREVIEW_IMAGE_CONTAINER:"ezcrop-preview-image-container",PREVIEW_IMAGE:"ezcrop-preview-image",PREVIEW_BACKGROUND_CONTAINER:"ezcrop-preview-background-container",PREVIEW_BACKGROUND:"ezcrop-preview-background",FILE_INPUT:"ezcrop-image-input",ZOOM_SLIDER:"ezcrop-image-zoom-input",DRAG_HOVERED:"ezcrop-drag-hovered",IMAGE_LOADING:"ezcrop-image-loading",IMAGE_LOADED:"ezcrop-image-loaded",DISABLED:"ezcrop-disabled"};t.CLASS_NAMES=o;var n={IMAGE_FAILED_TO_LOAD:{code:0,message:"Image failed to load."},SMALL_IMAGE:{code:1,message:"Image is too small."}};t.ERRORS=n;var s={PREVIEW:["mousedown","mouseup","mouseleave","touchstart","touchend","touchcancel","touchleave"],PREVIEW_MOVE:["mousemove","touchmove"],ZOOM_INPUT:["mousemove","touchmove","change"]};t.EVENTS=s},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var o=i(2),n={elements:[{name:"preview",defaultSelector:"."+o.CLASS_NAMES.PREVIEW},{name:"fileInput",defaultSelector:"input."+o.CLASS_NAMES.FILE_INPUT},{name:"zoomSlider",defaultSelector:"input."+o.CLASS_NAMES.ZOOM_SLIDER}].map(function(e){return e.type="element",e["default"]="imageCropper.querySelectorAll('"+e.defaultSelector+"')[0]",e}),values:[{name:"width",type:"number","default":null},{name:"height",type:"number","default":null},{name:"exportWidth",type:"number","default":null},{name:"imageBackground",type:"boolean","default":!1},{name:"imageBackgroundBorderWidth",type:"array or number","default":[0,0,0,0]},{name:"exportZoom",type:"number","default":1},{name:"allowDragNDrop",type:"boolean","default":!0},{name:"minZoom",type:"string","default":"fill"},{name:"maxZoom",type:"number","default":1},{name:"initialZoom",type:"string","default":"min"},{name:"freeMove",type:"boolean","default":!1},{name:"smallImage",type:"string","default":"reject"}],callbacks:[{name:"onFileChange",params:[{name:"event",type:"object"}]},{name:"onFileReaderError"},{name:"onImageLoading"},{name:"onImageLoaded"},{name:"onImageError",params:[{name:"error",type:"object"},{name:"error.code",type:"number"},{name:"error.message",type:"string"}]},{name:"onZoomEnabled"},{name:"onZoomDisabled"},{name:"onZoomChange",params:[{name:"zoom",type:"number"}]},{name:"onOffsetChange",params:[{name:"offset",type:"object"}]}].map(function(e){return e.type="function",e})},s=function(e){var t={};return e&&n.elements.forEach(function(i){t[i.name]=e.querySelectorAll(i.defaultSelector)[0]}),n.values.forEach(function(e){t[e.name]=e["default"]}),n.callbacks.forEach(function(e){t[e.name]=function(){}}),t};t.loadDefaults=s,t["default"]=n},function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){return"undefined"!=typeof e};t.exists=i;var o=function(e){return+(Math.round(100*e)+"e-2")};t.round=o}])});